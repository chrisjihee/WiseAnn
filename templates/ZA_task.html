{% extends "index.html" %}

{% block script_header %}
    <script type="text/javascript">
        var autosave = undefined;
        var taskdone = undefined;

        if (!getAuthCode())
            window.location = "/login/";
        $.ajax({
            url: "/ZA/",
            type: "get",
            async: true,
            beforeSend: function (req) {
                req.setRequestHeader("Authorization", authcode);
            }
        });

        const goList = function () {
            window.location = "/ZA/";
        };

        const showDeps = function (x) {
            $("div#" + x + ".deps").slideToggle("slow");
        };

        const test = function () {
            console.log("autosave1 = " + $(":radio[name=autosave]:checked").val());
            console.log("autosave2 = " + autosave);
            console.log("taskdone1 = " + $(":radio[name=taskdone]:checked").val());
            console.log("taskdone2 = " + taskdone);
        };

        $(function () {
            $("#username").text(username);
            const sent_td = $("td.sent");
            const max_h = Math.ceil(Math.pow($(".sent").width(), 0.75)) - 25;
            const offset = sent_td.offset().left;
            autosave = $(":radio[name=autosave]:checked").val() === "yes";
            taskdone = $(":radio[name=taskdone]:checked").val() === "yes";

            {% for sent in textcont.sents %}
                sent_td.width(document.body.clientWidth - 1);
                $("div#{{ sent.id }}.deps").append('<canvas id="{{ sent.id }}" class="deps" width="' + sent_td.width() + '" height="' + max_h + '" style="position:relative; top:15px;">');
                {% for word in sent.words %}
                    {% if word.head > 0 %}
                        linkTwo($("canvas#{{ sent.id }}.deps")[0], offset, $("#{{ sent.id }}.sent #{{ word.id }}.word"), $("#{{ sent.id }}.sent #{{ word.head }}.word"), max_h);
                    {% endif %}
                {% endfor %}
            {% endfor %}

            $(".word").mousedown(function () {
                $(this).prepend("{");
            }).mouseup(function () {
                $(this).append("}");
            });

            $("label").click(function () {
                $(this).removeClass("btn-default").addClass("btn-primary");
                $(this).siblings().removeClass("btn-primary").addClass("btn-default");
                setTimeout(function () {
                    $("#list").focus();
                    autosave = $(":radio[name=autosave]:checked").val() === "yes";
                    taskdone = $(":radio[name=taskdone]:checked").val() === "yes";
                }, 1);
            });
        });
    </script>
{% endblock script_header %}

{% block header %}
{% endblock header %}

{% block body %}
    <div style="margin-top:10px; margin-left:10px; margin-bottom:30px;">
        <div style="display:inline-block; font-size:16pt; font-weight:bold; position:relative; top:3px; margin-right:10px;">
            생략어 복원 Annotation
        </div>

        <div class="well well-sm"
             style="display:inline-block; text-align:center; font-size:11pt; width:400px; height:35px; margin-bottom:0">
            <i class="glyphicon glyphicon-file"> </i>
            <span id="textname">{{ textname }}</span>
        </div>

        <div class="btn-group" data-toggle="buttons" style="position:relative; top:-4px;">
            <label class="autosave btn btn-primary active">
                <input type="radio" name="autosave" value="yes" checked><i
                    class="glyphicon glyphicon-floppy-saved"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">저장</span></i>
            </label>
            <label class="autosave btn btn-default">
                <input type="radio" name="autosave" value="no"><i
                    class="glyphicon glyphicon-floppy-remove"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">연습</span></i>
            </label>
        </div>

        <div class="btn-group" data-toggle="buttons" style="position:relative; top:-4px;">
            <label class="taskdone btn btn-primary active">
                <input type="radio" name="taskdone" value="no" checked><i class="glyphicon glyphicon-pencil"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">진행</span></i>
            </label>
            <label class="taskdone btn btn-default">
                <input type="radio" name="taskdone" value="yes"><i class="glyphicon glyphicon-lock"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">완료</span></i>
            </label>
        </div>

        <button id="test" onclick="test()" class="btn btn-info" style="width:70px; position:relative; top:-4px;">
            <i class="glyphicon glyphicon-info-sign"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">확인</span></i>
        </button>

        <button id="list" onclick="goList()" class="btn btn-warning" style="width:70px; position:relative; top:-4px;">
            <i class="glyphicon glyphicon-th-list"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">목록</span></i>
        </button>

        <div class="well well-sm"
             style="display:inline-block; text-align:center; font-size:11pt; width:350px; height:35px; margin-bottom:0">
            <i class="glyphicon glyphicon-user"> </i>
            <span id="username"></span>
        </div>

        <button id="exit" onclick="doLogout()" class="btn btn-danger" style="width:70px; position:relative; top:-4px;">
            <i class="glyphicon glyphicon-off"><span
                    style="padding-left:3px; font-size:10.5pt; position:relative; top:-2px;">종료</span></i>
        </button>
    </div>

    <table class="table table-condensed table-striped list">
        <tr>
            <th style="width:50px; text-align:right; padding-right:8px;">idx</th>
            <th style="width:50px; text-align:center;">cmd</th>
            <th style="text-align:center;">sentence</th>
        </tr>
        {% for sent in textcont.sents %}
            <tr>
                <th style="text-align:right; vertical-align:top; padding-top:5px">{{ sent.id }}</th>
                <td style="text-align:right; vertical-align:top; padding-top:5px">
                    <button onclick="showDeps({{ sent.id }})" class="btn btn-info">
                        <i class="glyphicon glyphicon-search"> </i>
                    </button>
                    <button onclick="" class="btn btn-primary">
                        <i class="glyphicon glyphicon-plus"> </i>
                    </button>
                    <button onclick="" class="btn btn-danger">
                        <i class="glyphicon glyphicon-minus"> </i>
                    </button>
                </td>
                <td class="sent" style="line-height:150%; padding-top:5px;">
                    <div id="{{ sent.id }}" class="deps" style="display:none;"></div>
                    <table class="sent" id="{{ sent.id }}">
                        <tr>
                            {% for word in sent.words %}
                                <td>
                                    <table class="word" id="{{ word.id }}"
                                           style="display:inline-block; width:max-content; padding-right:3px;">
                                        <tr>
                                            <td class="word_label"
                                                style="text-align:center; font-size:9pt; font-family:Consolas; color:{{ word.label_color }}">{{ word.label }}</td>
                                        </tr>
                                        <tr>
                                            <td class="word_text"
                                                style="font-size:10pt; padding-left:10px; padding-right:10px;">{{ word.text }}</td>
                                        </tr>
                                    </table>
                                </td>
                            {% endfor %}
                        </tr>
                    </table>
                </td>
            </tr>
        {% endfor %}
    </table>

    <div style="padding-bottom:300px"></div>
{% endblock body %}
